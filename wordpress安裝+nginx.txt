## https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-on-centos-7
## https://medium.com/starbugs/web-server-nginx-2-bc41c6268646

# Wordpress > 安裝
  sudo yum -y update
  sudo yum -y upgrade

# 安裝 nginx
  sudo yum -y install epel-release
  sudo yum -y install nginx
  sudo systemctl start nginx
  sudo systemctl status nginx
  sudo systemctl enable nginx

# 防火牆
  sudo firewall-cmd --permanent --zone=public --add-service=http 
  sudo firewall-cmd --permanent --zone=public --add-service=https
  sudo firewall-cmd --reload
  *check ip , show 'welecome to centos' page is success

# 檢視nginx.conf配置
  sudo vim /etc/nginx/nginx.conf
  *user nginx;

# SELinux 模式與切換
  sudo setenforce 0
  
# install mariadb
  sudo yum -y install mariadb-server mariadb
  sudo systemctl start mariadb
  sudo systemctl enable mariadb
  sudo mysql_secure_installation

  sudo mysql -u root -p

# install PHP
  sudo yum -y install https://rpms.remirepo.net/enterprise/remi-release-7.rpm
  sudo yum -y install yum-utils
  sudo yum repolist all |grep php
  sudo yum-config-manager --enable remi-php74
  sudo yum -y install php php-cli php-fpm php-mysqlnd php-zip php-devel php-gd php-mcrypt php-mbstring php-curl php-xml php-pear php-bcmath php-json php-redis

# php-fpm
  sudo systemctl start php-fpm
  sudo systemctl status php-fpm
  sudo systemctl enable php-fpm

# 設置預設conf.d
  sudo vim /etc/nginx/conf.d/default.conf
  ***
  server {
      listen       80;
      server_name  localhost;
      access_log  /var/log/nginx/host.access.log  main;
      location / {
          root   /usr/share/nginx/html;
          index  index.html index.htm;
      }
      error_page   500 502 503 504  /50x.html;
      location = /50x.html {
          root   /usr/share/nginx/html;
      }
  }
  ***

# 簡單conf.d
  sudo vim *.com.conf
  
  ***
  upstream php {
    server 127.0.0.1:9000;
  }
  server {
    listen 80;
    server_name ffbnmo.com;
    index  index.php index.html;
    root  /website/ffbnmo.com/wordpress;

    location ~ \.php$ {
      include fastcgi.conf;
      fastcgi_intercept_errors on;
      fastcgi_pass php;
    }
  }
  ***


-------------------------------------------------------------------------------------------------------------


# 修改php.ini
  sudo vim /etc/php.ini

  *修改單一檔案大小上限
  upload_max_filesize = 16M
  post_max_size = 32M
  memory_limit = 64M
  max_execution_time = 0
  
  
# WordPress 繞過 FTP
  sudo vim wp-config.php
  
  *插入下列這行指令
  define('FS_METHOD', 'direct');
  
  
# 讓apache用root權限開啟wordpress資料夾
  sudo chown -R apache:root /websites/online2

  sudo find /var/www/html/wordpress/ -type d -exec chmod 775 {} \;
  sudo find /var/www/html/wordpress/ -type f -exec chmod 664 {} \;

# centos8
  php install
  https://www.footmark.info/linux/centos/centos-8-yum-php-mainline/
   
  網站伺服器的 PHP 環境缺少 WordPress 需要的 MySQL 擴充功能
  sudo dnf install php-mysqli  
   
# 更新資料夾權限
  find /var/www/html/wordpress/ -type f -exec chmod 664 {} \;
  find /var/www/html/wordpress/ -type d -exec chmod 775 {} \;

# SELinux 模式與切換
getenforce
  Enforcing：強制模式，依據設定來限制檔案資源存取。
  Permissive：寬容模式，不限制檔案資源存取，但仍會依據設定檢查並記錄相關訊息。
  Disabled：停用模式，SELinux 已被停用。

sudo setenforce 0
sudo setenforce 1
